# 미구현 및 개선사항 목록

> **작성일**: 2026-02-20
> **기준 문서**: `police/docs/관리자모드_개발명세서.md` (v2.0)
> **점검 범위**: 명세서 전체 섹션(0~9) 대비 현재 코드 전수 비교
> **목적**: 다른 AI 개발자가 이 문서를 보고 미구현 항목을 완성할 수 있도록 작성

---

## 점검 결과 요약

| 구분 | 항목 수 | 상태 |
|------|--------|------|
| 완전 구현 | 35+ | 명세서 대로 정상 구현됨 |
| **미구현** | **6** | 아래 상세 목록 참조 |
| **부분 구현** | **2** | 기능은 있으나 명세서 수준 미달 |
| **인프라 미비** | **3** | 코드가 아닌 환경/설정 문제 |

---

## A. 완전 구현 확인 완료 (작업 불필요)

아래 항목들은 명세서 대로 정상 구현되어 있으므로 **수정 불필요**:

- [x] Phase 0: DB 스키마 — SiteSetting, Banner, Notice, EventSection, DifficultyRating 모델 전부 존재
- [x] Phase 0: examNumber 필수화 — `String` (NOT NULL) + `@@unique([examId, regionId, examNumber])`
- [x] Phase 0: P2002 에러 분기 — examNumber 중복 vs userId+examId 중복 구분 메시지
- [x] Phase 0: `lib/upload.ts` — MIME 매직바이트 검증 포함
- [x] Phase 0: `lib/site-settings.ts` — 인메모리 캐시 헬퍼
- [x] Phase 1: 모집인원 관리 — API (`/api/admin/regions`) + UI (`/admin/regions`) 완비
- [x] Phase 1: 배너 관리 — API + UI + 3개 배너존(hero/middle/bottom) 완비
- [x] Phase 1: 사이트 기본 설정 — API + UI + 텍스트 설정/공지/시스템 설정 완비
- [x] Phase 1: 공지사항 관리 — CRUD + 기간/우선순위 완비
- [x] Phase 1: 체감 난이도 — submission API에 difficulty 파싱/저장 + `/api/difficulty` 집계 API + 랜딩 DifficultyPanel 표시
- [x] Phase 1: 원페이지 랜딩 — 배너존 A/B/C + ExamFunctionArea(4개 탭 실제 임베드) + NoticeBar + EventCard
- [x] Phase 2: 이벤트 섹션 관리 — CRUD + reorder API + 드래그 순서 변경 UI
- [x] Phase 2: 사용자 관리 — 검색/필터/페이지네이션 + 비밀번호 초기화 + 삭제
- [x] Phase 2: 댓글 관리 — 검색/필터 + 개별/일괄 삭제
- [x] Phase 3: 제출 현황 — 목록 + 상세(답안/점수) 모달 + 삭제
- [x] Phase 3: 점검 모드 — proxy.ts에서 차단 + /maintenance 페이지 + 관리자 UI 토글
- [x] OMR 듀얼 모드 — QuickOmrInput(PC) + RadioOmrInput(모바일) + 자동감지 + localStorage 저장
- [x] DifficultySelector — 과목별 3단계 토글 (쉬움/보통/어려움)
- [x] Header/Footer 동적 설정 — `/api/site-settings`에서 조회 + fallback
- [x] Result 페이지 examNumber 항상 표시
- [x] 관리자 네비게이션 — 11개 메뉴 완비
- [x] 대시보드 경고 — 경행경채 모집인원 미설정 + 정답키 미등록
- [x] 대시보드 빠른 작업 링크 — 10개 카드
- [x] 통계 페이지 난이도 현황 — 과목별 응답수/비율/대표 라벨

---

## B. 미구현 항목 (6건)

### B-1. 대시보드: 24시간 제출 추이 미니 차트

**명세서 위치**: 섹션 7.1 — "최근 24시간 제출 추이: 시간대별 제출 수 미니 차트"
**현재 상태**: 대시보드에 시각적 차트 없음 (KPI 카드 + 경고 배너 + 빠른 링크만 존재)
**파일**: `src/app/admin/page.tsx`

**구현 지시**:
```
1. /api/stats의 recentDateStats 데이터를 활용하여 Recharts 꺾은선 그래프(LineChart) 추가
2. 위치: KPI 카드 영역과 빠른 작업 링크 사이
3. X축: 최근 7~10일 날짜, Y축: 제출 건수
4. 크기: 높이 200px 정도의 미니 차트
5. 기존 admin/stats 페이지의 "최근 일자별 제출" 데이터를 재사용
```

---

### B-2. 통계 페이지: 점수 분포 히스토그램

**명세서 위치**: 섹션 7.2 — "점수 분포 히스토그램: 전체 최종점수 분포를 Recharts 바 차트로 표시"
**현재 상태**: 통계 페이지에 점수 분포 시각화 없음
**파일**: `src/app/admin/stats/page.tsx`, `src/app/api/stats/route.ts`

**구현 지시**:
```
1. /api/stats에 점수 분포 데이터 추가:
   - finalScore를 10점 단위 구간으로 그룹화 (0~10, 10~20, ..., 240~250)
   - 각 구간의 인원 수 집계
   - 공채/경행경채 별도 또는 통합 집계

2. /admin/stats 페이지에 Recharts BarChart 추가:
   - X축: 점수 구간 (0~10, 10~20, ...)
   - Y축: 인원 수
   - 막대 색상: 과락 구간(100점 미만)은 빨간색, 나머지 파란색
   - 위치: 기존 통계 테이블 위에 배치
```

---

### B-3. 통계 페이지: 지역별 평균 점수

**명세서 위치**: 섹션 7.2 — "지역별 평균 점수: 각 지역의 평균 원점수/최종점수"
**현재 상태**: 지역별 참여 인원 수만 표시, 평균 점수 없음
**파일**: `src/app/admin/stats/page.tsx`, `src/app/api/stats/route.ts`

**구현 지시**:
```
1. /api/stats의 지역별 통계에 평균 점수 추가:
   SELECT regionId,
          AVG(totalScore) as avgTotalScore,
          AVG(finalScore) as avgFinalScore,
          COUNT(*) as count
   FROM Submission
   WHERE examId = ?
   GROUP BY regionId

2. /admin/stats 페이지의 지역별 테이블에 컬럼 추가:
   | 지역 | 공채 | 경행경채 | 평균 원점수 | 평균 최종점수 |

3. 소수점 1자리까지 표시 (예: 187.5)
```

---

### B-4. 통계 페이지: CSV 다운로드

**명세서 위치**: 섹션 7.2 — "CSV 다운로드: 통계 데이터 CSV 내보내기"
**현재 상태**: CSV 내보내기 기능 없음
**파일**: `src/app/admin/stats/page.tsx`

**구현 지시**:
```
1. "CSV 다운로드" 버튼을 통계 페이지 상단에 추가

2. 클라이언트에서 현재 표시된 통계 데이터를 CSV로 변환:
   - BOM(UTF-8) 추가하여 한글 깨짐 방지: '\uFEFF' 접두사
   - 파일명: "합격예측_통계_{시험명}_{날짜}.csv"

3. CSV 내용 (탭별 시트 또는 섹션 구분):
   - 성별 통계 (남/여 인원)
   - 지역별 통계 (지역, 공채수, 경행경채수, 평균점수)
   - 일자별 제출 추이
   - 체감 난이도 (과목, 쉬움%, 보통%, 어려움%)

4. 구현 방법:
   const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8' });
   const url = URL.createObjectURL(blob);
   // a 태그 생성 + click() + revoke
```

---

### B-5. 정답 관리: CSV 템플릿 다운로드

**명세서 위치**: 섹션 7.3 — "CSV 템플릿 다운로드: 빈 양식 CSV 파일 다운로드 기능"
**현재 상태**: CSV 업로드 기능은 있으나 빈 양식 다운로드 없음
**파일**: `src/app/admin/answers/page.tsx`

**구현 지시**:
```
1. CSV 업로드 영역 옆에 "CSV 양식 다운로드" 버튼 추가

2. 클릭 시 빈 템플릿 CSV 생성 + 다운로드:
   과목,문항번호,정답
   헌법,1,
   헌법,2,
   ...
   헌법,20,
   형사법,1,
   형사법,2,
   ...
   형사법,40,
   경찰학,1,
   ...
   경찰학,40,

3. 공채용(헌법+형사법+경찰학)과 경행경채용(범죄학+형사법+경찰학) 2종 템플릿 제공
   - 또는 시험유형 선택 드롭다운 → 해당 유형 템플릿 다운로드

4. 파일명: "정답키_양식_{유형}.csv"
5. BOM(UTF-8) 포함
```

---

### B-6. 정답 관리: 정답 변경 이력(diff)

**명세서 위치**: 섹션 7.3 — "정답 변경 이력: 가답안 → 확정답안 변경 시 diff 표시"
**현재 상태**: 변경 이력/감사 로그 없음
**파일**: `src/app/admin/answers/page.tsx`, `src/app/api/admin/answers/route.ts`

**구현 지시**:
```
1. DB 스키마에 변경 이력 모델 추가 (선택적 — 간단 구현 가능):

   model AnswerKeyLog {
     id            Int      @id @default(autoincrement())
     examId        Int
     subjectId     Int
     questionNumber Int
     oldAnswer     Int?     // 이전 정답 (null이면 신규 등록)
     newAnswer     Int      // 변경된 정답
     changedBy     Int      // 변경한 관리자 userId
     createdAt     DateTime @default(now())
   }

2. 정답 저장 API에서 기존 값과 비교하여 변경된 문항만 AnswerKeyLog에 기록

3. /admin/answers 페이지에 "변경 이력 보기" 버튼 추가:
   - 모달 또는 접힘 패널로 표시
   - 테이블: 일시 | 과목 | 문항번호 | 이전 정답 | 변경 정답
   - 변경된 정답은 빨간/초록 색상으로 diff 표시

4. (간단 대안) AnswerKeyLog 모델 없이 구현:
   - 정답 저장 전/후 상태를 비교하여 프론트에서 diff 표시
   - 영구 이력은 남기지 않되, 저장 직후 "N개 문항이 변경되었습니다" 알림
```

---

## C. 부분 구현 항목 (2건)

### C-1. 통계 페이지: 일자별 제출 차트 (텍스트 → 시각적 차트로 개선)

**명세서 위치**: 섹션 7.2 — "시간대별 제출 차트: 일자별 제출 추이 꺾은선 그래프"
**현재 상태**: 텍스트 목록으로만 표시 ("2026-02-20: 45건" 형태), 시각적 차트 없음
**파일**: `src/app/admin/stats/page.tsx`

**개선 지시**:
```
1. "최근 일자별 제출" 텍스트 목록을 Recharts LineChart로 교체

2. 차트 스펙:
   - X축: 날짜 (최근 10~14일)
   - Y축: 제출 건수
   - 높이: 250px
   - 선 색상: #2563eb (파란색)
   - 데이터 포인트에 마우스 호버 시 Tooltip 표시

3. 기존 recentDateStats 데이터를 그대로 활용:
   <LineChart data={recentDateStats}>
     <XAxis dataKey="date" tick={{ fontSize: 11 }} />
     <YAxis tick={{ fontSize: 11 }} />
     <Tooltip />
     <Line type="monotone" dataKey="count" stroke="#2563eb" />
   </LineChart>

4. 차트 아래에 기존 텍스트 목록도 유지 (상세 수치 확인용)
```

---

### C-2. 정답 관리: 재채점 미리보기 (저장 후 → 저장 전으로 개선)

**명세서 위치**: 섹션 7.3 — "재채점 결과 미리보기: 정답 변경 시 영향받는 제출 수/점수 변동 미리보기"
**현재 상태**: 저장 **후** "재채점 처리: N건" 결과만 표시. 저장 **전** 미리보기 없음.
**파일**: `src/app/admin/answers/page.tsx`, `src/app/api/admin/answers/route.ts`

**개선 지시**:
```
1. "저장" 버튼 클릭 시 바로 저장하지 않고, 먼저 미리보기 API 호출:

   GET /api/admin/answers/preview?examId=1
   Body: { answers: [...변경할 정답 배열] }

   응답:
   {
     changedQuestions: 3,           // 변경되는 문항 수
     affectedSubmissions: 245,     // 영향받는 제출 수
     scoreChanges: {
       increased: 120,             // 점수 오르는 사용자 수
       decreased: 80,              // 점수 내리는 사용자 수
       unchanged: 45               // 점수 변동 없는 사용자 수
     }
   }

2. 미리보기 결과를 확인 다이얼로그에 표시:
   "정답 변경 시 N개 문항이 바뀌며, M명의 점수가 재계산됩니다.
    (상승 X명 / 하락 Y명 / 변동없음 Z명)
    저장하시겠습니까?"

3. (간단 대안) 미리보기 API 없이, 변경된 문항 수만 카운트:
   - 프론트에서 기존 정답과 새 정답을 비교하여 변경 문항 수 표시
   - "N개 문항이 변경됩니다. 저장 시 전체 재채점이 실행됩니다." 확인 후 저장
```

---

## D. 인프라 미비 항목 (3건)

### D-1. DB 마이그레이션 미실행

**현재 상태**: `prisma/migrations/` 디렉토리가 존재하지 않음. 스키마에 모델은 정의되어 있으나 마이그레이션이 한 번도 실행되지 않은 상태.

**실행 지시**:
```bash
cd police

# MySQL 서버 실행 확인 후
npx prisma migrate dev --name init_all_models

# 시드 데이터 입력
npx prisma db seed
```

> **주의**: examNumber가 NOT NULL이므로, 기존 데이터가 있는 DB에 마이그레이션 시
> `UPDATE Submission SET examNumber = CONCAT('LEGACY-', id) WHERE examNumber IS NULL` 선행 필요.
> 신규 DB라면 바로 마이그레이션 가능.

---

### D-2. 이미지 업로드 디렉토리 없음

**현재 상태**: `public/uploads/` 디렉토리 구조가 존재하지 않음.

**실행 지시**:
```bash
cd police
mkdir -p public/uploads/banners
mkdir -p public/uploads/events
```

> `lib/upload.ts`가 디렉토리 자동 생성(`mkdirSync`)을 지원하는지 확인 필요.
> 지원하지 않으면 upload.ts에 `fs.mkdirSync(dir, { recursive: true })` 추가.

---

### D-3. seed.ts에 신규 모델 샘플 데이터 없음

**현재 상태**: seed.ts는 SiteSetting(8건)만 시딩. Banner, Notice, EventSection은 시딩하지 않음.

**개선 지시 (선택적)**:
```
seed.ts에 아래 샘플 데이터 추가 (개발/테스트 편의):

1. Banner 샘플 (선택적 — 관리자가 직접 업로드하는 것이 정상 플로우):
   - 없어도 됨 (HeroFallback이 작동하므로)

2. Notice 샘플 1건:
   { title: "시험일: 2026.3.14(토)", content: "합격발표: 2026.3.20(금) 17:00", isActive: true, priority: 1 }

3. EventSection은 시딩 불필요 (관리자가 직접 등록)
```

---

## E. 구현 우선순위 및 작업 지시

### 즉시 필요 (서비스 운영 전 필수)

```
1순위: D-1 마이그레이션 실행 + D-2 업로드 디렉토리 생성
       → 이 두 가지 없으면 서비스 자체가 실행 불가
```

### 권장 개선 (사용자 경험/관리 편의)

```
2순위: C-1 일자별 제출 차트 시각화 (텍스트 → Recharts LineChart)
       → Recharts는 이미 프로젝트에 설치되어 있으므로 간단 작업
       → 예상 작업량: 30분 이내

3순위: B-4 통계 CSV 다운로드
       → 프론트엔드만 수정 (API 변경 없음)
       → 예상 작업량: 1시간 이내

4순위: B-5 정답 관리 CSV 템플릿 다운로드
       → 프론트엔드만 수정
       → 예상 작업량: 30분 이내
```

### 선택 개선 (있으면 좋지만 운영 가능)

```
5순위: B-2 점수 분포 히스토그램 (API + UI)
6순위: B-3 지역별 평균 점수 (API + UI)
7순위: B-1 대시보드 미니 차트
8순위: C-2 재채점 미리보기 개선
9순위: B-6 정답 변경 이력 (DB 모델 추가 필요)
```

---

## F. 다른 AI에게 전달할 작업 지시 프롬프트

아래 프롬프트를 복사하여 다른 AI에게 전달하세요:

```
경찰 합격예측 프로젝트(police/)의 미구현 및 개선사항을 구현해주세요.

먼저 아래 파일들을 반드시 읽어주세요:
- CLAUDE.md (프로젝트 전체 가이드)
- police/docs/관리자모드_개발명세서.md (관리자 기능 명세서 v2.0)
- police/docs/미구현_및_개선사항.md (이 문서 — 구체적인 작업 목록)

작업 순서:

[1단계] 인프라 세팅 (D-1, D-2)
- prisma migrate dev 실행 가능하도록 마이그레이션 생성
- public/uploads/banners/, public/uploads/events/ 디렉토리 생성
- lib/upload.ts에 디렉토리 자동 생성 로직이 없으면 추가

[2단계] 통계 차트 시각화 (C-1, B-1)
- /admin/stats 페이지: 일자별 제출 텍스트 목록 → Recharts LineChart로 교체
- /admin/page.tsx 대시보드: 미니 제출 추이 차트 추가 (높이 200px LineChart)
- 프로젝트에 이미 설치된 Recharts 사용

[3단계] 통계 데이터 확장 (B-2, B-3)
- /api/stats에 점수 분포(10점 단위 구간) + 지역별 평균 점수 데이터 추가
- /admin/stats 페이지에 점수 분포 BarChart + 지역별 평균 점수 테이블 추가

[4단계] CSV 기능 (B-4, B-5)
- /admin/stats 페이지에 "CSV 다운로드" 버튼 (프론트엔드 CSV 생성, UTF-8 BOM 포함)
- /admin/answers 페이지에 "CSV 양식 다운로드" 버튼 (공채/경행경채 2종 템플릿)

[5단계] 정답 관리 개선 (C-2, B-6) — 선택 작업
- 재채점 미리보기: 저장 전 변경 문항 수 + 영향 제출 수 표시
- 정답 변경 이력: AnswerKeyLog 모델 추가 또는 프론트 diff 표시

주의사항:
- 기존 코드 패턴(CLAUDE.md, 명세서 섹션 8.2)을 반드시 따를 것
- 모든 UI 텍스트는 한글로 작성
- Recharts는 이미 설치되어 있으므로 추가 설치 불필요
- 기존 구현된 코드를 훼손하지 말 것
```
