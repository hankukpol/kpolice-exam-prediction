# 07. 탭 구조 개편 및 신규 기능 개발 명세

> 작성일: 2026-02-20
> 대상: `police/` (경찰 합격예측 1단계)

---

## UI 레퍼런스 이미지 매핑

| 레퍼런스 | 파일 | 대응 탭 |
|---------|------|--------|
| **참고 자료/1.png** | 응시정보 입력 폼 | 탭2: 빠른 채점 서비스 |
| **참고 자료/2.png** | 내 성적 분석 (바 차트 + 상세 테이블) | 탭3: 채점결과 분석 |
| **참고 자료/3.png** | 합격 컷/경쟁자 정보 (피라미드 + 분포도) | 탭4: 합격예측 분석 |
| `20260220_202218.png` | 실시간 합격예측 분석 테이블 | 탭1: 풀서비스 메인 |
| `20260220_202230.png` | 최대/최소 경쟁 지역 TOP5 | 탭1: 풀서비스 메인 |
| `20260220_202245.png` | 과목별 체감난이도 5단계 | 탭1: 풀서비스 메인 |
| `20260220_202831.png` | 합격등급별 점수대 바 차트 | 탭4: 합격예측 분석 (추가) |
| `20260220_202838.png` | 채점자 예측 결과 + 성적분포도 | 탭4: 합격예측 분석 (추가) |
| `20260220_202846.png` | 동일 직렬 지역별 성적 테이블 | 탭4: 합격예측 분석 (추가) |

---

## 1. 변경 개요

### 1.1 탭 메뉴 구조 변경

| 순서 | 기존 탭명 | 변경 탭명 | 라우트 | 상태 |
|------|----------|----------|--------|------|
| 1 | _(없음)_ | **풀서비스 메인** | `/exam/main` | **신규 개발** |
| 2 | 응시정보 입력 | **빠른 채점 서비스** | `/exam/input` | 라벨 변경 + UI 조정 |
| 3 | 내 성적 분석 | **채점결과 분석** | `/exam/result` | 라벨 변경 + UI 재배치 |
| 4 | 합격 컷/경쟁자 정보 | **합격예측 분석** | `/exam/prediction` | 라벨 변경 + **대규모 기능 추가** |
| 5 | 실시간 댓글 | **댓글** | `/exam/comments` | 라벨만 변경 |

### 1.2 탭 활성화 조건

| 탭 | 조건 |
|----|------|
| 풀서비스 메인 | **항상 활성화** (로그인만 필요) |
| 빠른 채점 서비스 | 항상 활성화 |
| 채점결과 분석 | hasSubmission |
| 합격예측 분석 | hasSubmission |
| 댓글 | hasSubmission |

### 1.3 기본 라우트 변경

- 기존: `/exam` → `/exam/input` 리디렉트
- 변경: `/exam` → `/exam/main` 리디렉트

---

## 2. 탭1: 풀서비스 메인 (`/exam/main`) — 신규 페이지

> 참고: `20260220_202218.png`, `20260220_202230.png`, `20260220_202245.png`

이번 시험의 전체 정보를 실시간으로 보여주는 **시험 정보 대시보드**.
로그인만 하면 답안 제출 여부와 무관하게 누구나 열람 가능.

### 2.1 페이지 섹션 구성

```
풀서비스 메인 페이지
├── [A] 시험 정보 헤더 + 실시간 참여 현황
├── [B] 실시간 합격예측 분석 테이블
├── [C] 실시간 최대/최소 경쟁 예상 지역 TOP5
├── [D] 과목별 체감난이도 (5단계)
└── [E] 공지사항 / 안내
```

### 2.2 [A] 시험 정보 헤더 + 실시간 참여 현황

```
┌──────────────────────────────────────────────────────────┐
│  2026년 제1차 경찰공무원 순경 필기시험                         │
│  합격예측 서비스                                             │
│                                                          │
│  시험일: 2026.03.14(토) │ 합격발표: 2026.03.20(금)          │
│  전체 채용인원: 3,202명 │ 과목: 헌법/형사법/경찰학(공채)       │
│                                                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  │
│  │ 총 참여자   │  │ 공채      │  │ 경행경채   │  │ 최근 1시간 │  │
│  │  1,247명  │  │  1,089명  │  │   158명   │  │   43명   │  │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  │
│                               실시간 업데이트중 ● 2026-03-14 12:34  │
└──────────────────────────────────────────────────────────┘
```

- 시험 기본 정보: 시험명, 시험일, 합격발표일, 전체 채용인원, 시험과목
- 실시간 참여 현황 카드: 총 참여자 / 공채 / 경행경채 / 최근 1시간
- 60초 간격 자동 갱신 (폴링)
- 데이터 소스: 기존 `getLiveStats()` 로직 활용 + 시험 정보 조회

### 2.3 [B] 직렬별 실시간 합격예측 분석

> 참고: `20260220_202218.png`, `20260221_005627.png`

**공채/경행경채 탭**으로 직렬을 선택하고, **지역 버튼 그리드**에서 지역을 선택하면
해당 직렬+지역의 합격예측 분석 데이터가 표시되는 구조.

#### 전체 레이아웃

```
┌──────────────────────────────────────────────────────────────┐
│  직렬별 실시간 합격예측 분석           UPDATE 03.14. 12:34:15  │
│                                                              │
│  ┌─────────┐ ┌─────────┐                                    │
│  │  공 채   │ │ 경행경채  │    ← 직렬 탭 (토글)                │
│  └─────────┘ └─────────┘                                    │
│                                                              │
│  지역 선택                                                    │
│  ┌────┐ ┌──────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐       │
│  │강원│ │경기남부│ │경기북│ │경남│ │경북│ │광주│ │대구│       │
│  └────┘ └──────┘ └────┘ └────┘ └────┘ └────┘ └────┘       │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ │
│  │대전│ │부산│ │서울│ │세종│ │울산│ │인천│ │전남│ │전북│ │
│  └────┘ └────┘ └────┘ └────┘ └────┘ └────┘ └────┘ └────┘ │
│  ┌────┐ ┌────┐                                              │
│  │충남│ │충북│      ← 선택된 지역 하이라이트 (초록색)          │
│  └────┘ └────┘                                              │
│                                                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                   공채 : 대구                          │  │
│  │                                                       │  │
│  │  ┌────────────────────┐  ┌────────────────────────┐   │  │
│  │  │ 좌측 테이블          │  │ 우측 테이블              │   │  │
│  │  │                    │  │                        │   │  │
│  │  │ 지역-직렬   대구-공채│  │ 실시간 평균점수  158.96점│   │  │
│  │  │ 선발인원       92명 │  │ 선발인원           92명 │   │  │
│  │  │ 접수인원     1,840명│  │ 접수인원         1,840명│   │  │
│  │  │ 경쟁률      20.00:1│  │ 경쟁률          20.00:1│   │  │
│  │  │                    │  │                        │   │  │
│  │  │ 합격가능권 데이터수집중│  │                        │   │  │
│  │  │ 합격유력권 데이터수집중│  │                        │   │  │
│  │  │ 합격확실권   -점 이상│  │                        │   │  │
│  │  │ 1배수입력자컷    -  │  │                        │   │  │
│  │  └────────────────────┘  └────────────────────────┘   │  │
│  └───────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────┘
```

#### 직렬 탭 (상단)

| 탭 | 표시 | 선택 시 동작 |
|----|------|-----------|
| **공채** | 기본 선택 (활성 상태) | 지역 버튼 클릭 시 공채 기준 데이터 표시 |
| **경행경채** | 비활성 상태 | 지역 버튼 클릭 시 경행경채 기준 데이터 표시 |

- 탭 전환 시 지역 선택 유지 (같은 지역의 다른 직렬 데이터로 전환)
- 활성 탭: 진한 배경 + 하단 인디케이터

#### 지역 버튼 그리드 (18개 시도경찰청)

- 버튼 형태: 둥근 모서리 버튼, 가로 나열 (flex-wrap)
- 선택된 지역: 초록색 배경 하이라이트 (스크린샷 참고)
- 미선택 지역: 기본 배경
- **답안 제출자**: 자신의 지역이 기본 선택됨
- **미제출자**: 첫 번째 지역(강원) 기본 선택

#### 결과 카드 (하단)

선택된 직렬+지역의 합격예측 데이터를 **좌우 2열 카드**로 표시:

**좌측 열 (기본 정보)**:

| 항목 | 값 |
|------|-----|
| 지역-직렬 | "대구-공채" |
| 선발인원 | 92명 |
| 접수인원 | 1,840명 |
| 경쟁률 | 20.00 : 1 |
| 합격가능권 | {점수} 이하 ~ {점수} 이상 (또는 "데이터 수집 중") |
| 합격유력권 | {점수} 이하 ~ {점수} 이상 (또는 "데이터 수집 중") |
| 합격확실권 | {점수} 이상 |
| 1배수 입력자 컷 | {점수} |

**우측 열 (실시간 통계)**:

| 항목 | 값 |
|------|-----|
| 실시간 평균점수 | 158.96점 |
| 선발인원 | 92명 |
| 접수인원 | 1,840명 |
| 경쟁률 | 20.00 : 1 |

#### 동작 상세

1. 직렬 탭 전환 → 같은 지역, 다른 직렬 데이터로 갱신
2. 지역 버튼 클릭 → 같은 직렬, 다른 지역 데이터로 갱신
3. 참여인원 < 10명인 경우: 합격가능권/유력권/확실권 = "데이터 수집 중"
4. 60초 간격 자동 갱신 (전체 데이터 한 번에 가져와 클라이언트에서 필터링)

### 2.4 [C] 실시간 최대/최소 경쟁 예상 지역 TOP5

> 참고: `20260220_202230.png`

두 개의 **수평 바 차트**를 좌우로 나란히 배치.

#### 좌측: 최대 경쟁 예상 지역 TOP5

- 정렬: `(합격확실권 점수 - 실시간 입력자 평균)` 값이 **가장 큰** 5개 지역
- 의미: 확실권 대비 평균이 많이 낮음 = 경쟁 치열
- 가로 막대 2종: 회색(실시간 입력자 평균) + 파란색(합격확실권 점수)

#### 우측: 최소 경쟁 예상 지역 TOP5

- 정렬: 위와 반대, 값이 **가장 작은** 5개 지역
- 의미: 평균이 확실권에 근접 = 비교적 경쟁 완만

#### 차트 스펙

```
Recharts BarChart (layout="vertical")
- Y축: "대구-공채", "경북-공채" 등 지역-유형명
- X축: 점수 (0~250)
- 막대: 회색(#9CA3AF, 입력자 평균) + 파란색(#2563EB, 확실권 점수)
- 각 막대 끝에 숫자 라벨 표시
```

### 2.5 [D] 과목별 체감난이도 (5단계)

> 참고: `20260220_202245.png`

기존 3단계(쉬움/보통/어려움)를 **5단계**로 세분화.

#### UI 구성

```
┌────────────────────────────────────────────────┐
│  과목별 체감난이도                                   │
│  ┌──────────┐  ┌──────────┐                    │
│  │ 과목선택  ▼│  │ 유형선택  ▼│                    │
│  └──────────┘  └──────────┘                    │
│                                                │
│  ┌────┐  ┌────┐  ┌════════┐  ┌────┐  ┌────┐  │
│  │3.58│  │9.24│  │ 44.75% │  │24.65│  │11.34│  │
│  │ %  │  │ %  │  │        │  │ %  │  │ %  │  │
│  └────┘  └────┘  └════════┘  └────┘  └────┘  │
│  매우    쉬움     보통      어려움   매우    │
│  쉬움                             어려움    │
└────────────────────────────────────────────────┘
```

- 과목 드롭다운: 전체 / 헌법(공채) / 범죄학(경행경채) / 형사법 / 경찰학
- 유형 드롭다운: 전체 / 공채 / 경행경채
- Recharts BarChart: X축=5단계, Y축=비율(%)
- 각 막대 위 퍼센트 라벨

#### DB 변경: 5단계 enum

```
기존: EASY | NORMAL | HARD
변경: VERY_EASY | EASY | NORMAL | HARD | VERY_HARD
```

### 2.6 [E] 공지사항 / 안내

- 관리자가 등록한 공지사항 표시 (기존 NoticeBar 활용)
- 서비스 이용 안내, 주의사항 등

### 2.7 필요 API

```
GET /api/main-stats?examType={PUBLIC|CAREER}
```

```typescript
interface MainStatsResponse {
  updatedAt: string;
  exam: {
    id: number;
    name: string;
    year: number;
    round: number;
    examDate: string;
    totalRecruitCount: number;   // 전체 채용인원
  };
  liveStats: {
    totalParticipants: number;
    publicParticipants: number;
    careerParticipants: number;
    recentParticipants: number;  // 최근 1시간
  };
  rows: MainStatsRow[];
  topCompetitive: CompetitiveRank[];
  leastCompetitive: CompetitiveRank[];
}

interface MainStatsRow {
  regionId: number;
  regionName: string;
  examType: "PUBLIC" | "CAREER";
  examTypeLabel: string;
  recruitCount: number;
  estimatedApplicants: number;
  competitionRate: number;
  participantCount: number;
  averageFinalScore: number | null;
  oneMultipleCutScore: number | null;
  possibleRange: { min: number | null; max: number | null };
  likelyRange: { min: number | null; max: number | null };
  sureMinScore: number | null;
}

interface CompetitiveRank {
  rank: number;
  label: string;                    // "대구-공채"
  averageFinalScore: number;
  sureMinScore: number;
  gap: number;
}
```

---

## 3. 탭2: 빠른 채점 서비스 (`/exam/input`)

> 레퍼런스: **참고 자료/1.png**

기존 "응시정보 입력" 페이지의 UI를 레퍼런스 기준으로 재배치.

### 3.1 입력 폼 구성 (레퍼런스 기반)

참고 자료/1.png를 경찰 시험 규정에 맞게 적용:

```
┌──────────────────────────────────────────────────────┐
│                                                      │
│  성명                          성별                   │
│  ┌────────────────────┐       ┌────────────────┐     │
│  │ (자동: 로그인 사용자명) │       │ 선택하세요    ▼│     │
│  └────────────────────┘       └────────────────┘     │
│                                                      │
│  ┌─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐  │
│  │ 채용유형           지역선택         시험구분      │  │
│  │ ┌──────────┐    ┌──────────┐    ┌──────────┐  │  │
│  │ │ 공채    ▼│    │ 지역선택  ▼│    │ 경찰 1차  │  │  │
│  │ └──────────┘    └──────────┘    └──────────┘  │  │
│  │                                               │  │
│  │   채용유형 및 지역을 편리하게 입력할 수 있습니다.  │  │
│  └─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘  │
│                                                      │
│  응시번호                                             │
│  ┌────────────────────┐                              │
│  │ (선택 입력)          │                              │
│  └────────────────────┘                              │
│                                                      │
│  시험과목(필수) — OMR 답안 입력                         │
│  ┌──────────────────────────────────────────────┐    │
│  │  [헌법(20문항)] [형사법(40문항)] [경찰학(40문항)]  │    │
│  │  OMR 그리드 영역 (기존 RadioOmr / QuickOmr)      │    │
│  └──────────────────────────────────────────────┘    │
│                                                      │
│  ┌─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐  │
│  │ 가산점                                         │  │
│  │                                               │  │
│  │ 취업지원대상자   ○ 0%    ○ 5%    ○ 10%        │  │
│  │ 의사상자        ○ 0%    ○ 3%    ○ 5%         │  │
│  │                                               │  │
│  │   본인의 가산점을 카테고리 별로 구분되어           │  │
│  │   한눈에 파악하기 쉽습니다.                      │  │
│  └─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘  │
│                                                      │
│  체감난이도 (선택)                                     │
│  과목별 5단계: 매우 쉬움 / 쉬움 / 보통 / 어려움 / 매우 어려움  │
│                                                      │
│          [ 채점하기 ]                                  │
└──────────────────────────────────────────────────────┘
```

### 3.2 기존 대비 변경점

| 항목 | 기존 | 변경 |
|------|------|------|
| 탭 라벨 | "응시정보 입력" | **"빠른 채점 서비스"** |
| 페이지 제목 | "응시정보 및 OMR 답안 입력" | **"빠른 채점 서비스"** |
| 폼 레이아웃 | 세로 나열 | **참고 자료/1.png 기반 그룹핑** (점선 영역으로 관련 필드 묶기) |
| 채용유형+지역 | 개별 필드 | **점선 강조 영역**으로 묶어 그룹화 (참고 자료/1.png의 빨간 점선 영역) |
| 가산점 영역 | 개별 필드 | **점선 강조 영역**으로 묶어 그룹화 |
| 시험구분 | 없음 | **"경찰 1차" 읽기전용** 필드 추가 |
| 체감난이도 | 기존 3단계 | **5단계** (매우 쉬움 ~ 매우 어려움) |
| 제출 버튼 | "제출하기" | **"채점하기"** |

### 3.3 변경할 파일

| 파일 | 변경 내용 |
|------|---------|
| `src/app/exam/input/page.tsx` | 폼 레이아웃 재배치 (그룹핑), 제목/버튼 텍스트 변경 |
| `src/components/exam/DifficultySelector.tsx` | 5단계 라디오 버튼으로 변경 |

---

## 4. 탭3: 채점결과 분석 (`/exam/result`)

> 레퍼런스: **참고 자료/2.png**

### 4.1 페이지 구성 (레퍼런스 기반)

참고 자료/2.png의 레이아웃을 경찰 시험 규정에 맞게 적용:

```
┌──────────────────────────────────────────────────────┐
│  내점수                                    ■ 내점수    │
│                                                      │
│  100 ┤                                               │
│   80 ┤              ████████     ████████             │
│   60 ┤              ████████     ████████             │
│   40 ┤   ██████     ████████     ████████             │
│   20 ┤   ██████     ████████     ████████             │
│    0 ┤   ██████     ████████     ████████             │
│        헌법(35.0)   형사법(92.5)  경찰학(90.0)         │
│                                                      │
│  ┌────────┬────────┬────────┬────────┬────────┐      │
│  │ 구분    │ 총점    │ 헌법    │ 형사법  │ 경찰학  │      │
│  ├────────┼────────┼────────┼────────┼────────┤      │
│  │ 원점수  │ 217.5  │  35.0  │  92.5  │  90.0  │      │
│  ├────────┼────────┼────────┼────────┼────────┤      │
│  │ 백분위  │  81.4  │  33.4  │  84.1  │   —    │      │
│  ├────────┼────────┼────────┼────────┼────────┤      │
│  │석차/    │100/596 │363/596 │ 69/596 │   —    │      │
│  │전체인원 │        │        │        │        │      │
│  ├────────┼────────┼────────┼────────┼────────┤      │
│  │ 과락    │   —    │   —    │   —    │   —    │      │
│  └────────┴────────┴────────┴────────┴────────┘      │
│                                                      │
│  ※ 순위 기준: 동일 채용유형 참여자 기준                   │
└──────────────────────────────────────────────────────┘
```

### 4.2 기존 대비 변경점

| 항목 | 기존 | 변경 |
|------|------|------|
| 탭 라벨 | "내 성적 분석" | **"채점결과 분석"** |
| 바 차트 제목 | "내 성적 분석" | **"내점수"** (레퍼런스 기준) |
| 바 차트 범례 | 없음 | **"■ 내점수"** 우측 상단 범례 |
| 바 차트 라벨 | 없음 | **막대 위에 과목명(점수)** 표시 |
| 상세 테이블 | 기존과 동일한 구조 | 레퍼런스 디자인에 맞춰 **테이블 스타일 정리** |
| 석차 행 | "석차/전체인원" 1행 | **"석차/전체인원" 1행** (경찰은 통합선발이므로 성별 석차 행 불필요) |
| 가산점 요약 | 별도 섹션 | 테이블 하단에 **간결하게 통합** |

### 4.3 추가 기능: 정오표 (문항별 정답/오답)

바 차트 + 상세 테이블 아래에 정오표 섹션 추가:

```
┌──────────────────────────────────────────────────────┐
│  정오표 — 문항별 정답/오답 분석                           │
│  [헌법] [형사법] [경찰학]                                │
│                                                      │
│  ┌────┬──────┬──────┬──────┬────────┐                │
│  │번호 │ 내 답 │ 정답  │ 결과  │ 정답률  │                │
│  ├────┼──────┼──────┼──────┼────────┤                │
│  │  1 │  ②   │  ②   │  O   │ 87.3%  │                │
│  │  2 │  ③   │  ①   │  X   │ 45.1%  │                │
│  │  3 │  ①   │  ①   │  O   │ 72.0%  │                │
│  │ ...│      │      │      │        │                │
│  └────┴──────┴──────┴──────┴────────┘                │
│                                                      │
│  정답: 파란색 O │ 오답: 빨간색 X                         │
│  정답률 40% 미만 문항: 노란 하이라이트 (고난도 문항)        │
└──────────────────────────────────────────────────────┘
```

### 4.4 추가 기능: 과목별 점수 비교

바 차트에 비교 데이터 오버레이:

- **내 점수**: 채워진 파란 막대 (기존)
- **동일 유형+지역 평균**: 회색 점선 마커 라인
- **전체 최고점**: 빨간 삼각형 마커

### 4.5 변경할 파일

| 파일 | 변경 내용 |
|------|---------|
| `src/app/exam/result/page.tsx` | 레이아웃 재배치 + 정오표 섹션 + 비교 오버레이 |
| `src/app/api/result/route.ts` | answers 배열 + averageScore/maxScoreInPool 추가 |

### 4.6 API 응답 확장

기존 `GET /api/result` 응답에 추가:

```typescript
interface ResultResponse {
  // ... 기존 필드 (submission, scores, statistics)

  // 신규: 정오표 데이터
  answers: Array<{
    subjectId: number;
    subjectName: string;
    items: Array<{
      questionNumber: number;
      selectedAnswer: number;
      correctAnswer: number;
      isCorrect: boolean;
      correctRate: number;          // 전체 참여자 정답률 (%)
    }>;
  }>;

  // 신규: 과목별 비교 데이터 (scores 각 항목에 추가)
  scores: Array<{
    // ... 기존 필드
    averageScore: number;           // 동일 유형+지역 과목 평균
    maxScoreInPool: number;         // 동일 유형+지역 과목 최고점
  }>;
}
```

---

## 5. 탭4: 합격예측 분석 (`/exam/prediction`)

> 레퍼런스: **참고 자료/3.png** (메인 레이아웃)
> 추가: `20260220_202831.png`, `20260220_202838.png`, `20260220_202846.png`

### 5.1 페이지 구성 (레퍼런스 기반)

참고 자료/3.png를 메인 골격으로 하고, 추가 스크린샷의 기능을 통합:

```
합격예측 분석 페이지
├── [A] 순위 헤더 (참고 자료/3.png 상단)
├── [B] 내 정보 카드 + 합격예측 피라미드 (참고 자료/3.png 중앙)
├── [C] 합격등급별 점수대 바 차트 (20260220_202831.png)
├── [D] 채점자 예측 결과 + 성적분포도 (20260220_202838.png)
├── [E] 성적 분포도 & 경쟁자 정보 (참고 자료/3.png 하단)
├── [F] 동일 직렬 채점자 성적 - 지역별 (20260220_202846.png)
└── [G] 면책조항
```

### 5.2 [A] 순위 헤더

> 참고 자료/3.png 상단

```
┌──────────────────────────────────────────────────┐
│          김단기 회원님은 현재                        │
│      공채 입력자 335명 중 23등입니다.                │
└──────────────────────────────────────────────────┘
```

- 기존 구현과 동일 (유지)

### 5.3 [B] 내 정보 카드 + 합격예측 피라미드

> 참고 자료/3.png 중앙

좌우 2단 레이아웃:

```
┌──────────────────┐  ┌──────────────────────────────┐
│ 공채 - 대구        │  │ 합격 예측                       │
│                   │  │                              │
│ 내점수    배수점    │  │    /\   217.50이상            │
│ 217.5    217.5    │  │   /확\   합격 확실권 [내위치]   │
│                   │  │  /실권\                       │
│ 선발   출원   참여  │  │ /──────\  215.00 이상         │
│ 인원   인원   인원  │  │/유력권  \  합격 유력권         │
│  92   1,840  596  │  │/────────\                    │
│                   │  │ 가능권    \  212.50 이상       │
│                   │  │──────────\  합격 가능권        │
│                   │  │ 212.50 미만                   │
└──────────────────┘  └──────────────────────────────┘
```

**내 정보 카드** (좌측):
- 채용유형 + 지역 (예: "공채 - 대구")
- 내점수 / 배수점
- 선발인원 / 출원인원 / 참여인원

**합격예측 피라미드** (우측) — 참고 자료/3.png 스타일:
- 삼각형 피라미드 형태 (기존 trapezoid → 삼각형 피라미드로 변경)
- 각 등급 옆에 기준 점수 + 등급명 표시
- **내위치** 배지: 해당 등급에 [내위치] 표시
- 등급: 확실권 → 유력권 → 가능권 → 도전권 (4단계로 단순화)
- 색상: 참고 자료/3.png 기준 그라데이션 (진한 남색 → 밝은 하늘색)

### 5.4 [C] 합격등급별 점수대 바 차트

> 참고: `20260220_202831.png`

피라미드 아래에 **등급별 점수 범위를 바 차트로 시각화**.

```
┌──────────────────────────────────────────────────────┐
│  합격예측 분석     내 위치는 어디쯤일까?                  │
│                                                      │
│  응시직렬: 대구-공채          선발인원: 92명             │
│  내 점수: 217.50             출원인원: 1,840명          │
│                                                      │
│  kunryong 회원님은 현재, 대구-공채 입력자 596명 중       │
│  23등입니다.                                          │
│                            실시간 기준시간: 2026-03-14  │
│                                                      │
│    합격 확실권       합격 유력권        합격 가능권       │
│   217.50점 이상   217.49~215.00점   214.99~212.50점   │
│     ┌─────┐                                          │
│ 220─┤     │                                          │
│     │     │                                          │
│ ━━━━┤━━━━━│━━━━━━━━━━━━━━━━━━━━━━━━━  ← 내 위치     │
│ 217─┤     │                           (217.50)       │
│     │     │        ┌─────┐                           │
│ 215─┤     │        │     │                           │
│     │     │        │     │                           │
│ 213─┤     │        │     │        ┌─────┐            │
│     │     │        │     │        │     │            │
│ 212─┤     │        │     │        │     │            │
│     └─────┘        └─────┘        └─────┘            │
└──────────────────────────────────────────────────────┘
```

- Recharts BarChart (세로 막대)
- X축: 3개 등급 (확실권/유력권/가능권)
- Y축: 점수 (동적 범위)
- 막대: 등급별 점수 범위 (min~max), 초록/파랑/회색
- **내 위치**: 가로 빨간 점선 + "내 위치" 라벨

**데이터 소스**: 기존 `/api/prediction` 응답의 `pyramid.levels`에서 추출 (추가 API 불필요)

### 5.5 [D] 채점자 예측 결과 + 과목별 성적분포도

> 참고: `20260220_202838.png`, `20260221_012109.png`
>
> **변경**: 기존 스크린샷의 "필수과목: 채점자 성적 분포"는 2026년 시험에 해당하지 않음.
> 현행 경찰시험은 "필수/선택" 구분 없이 **전 과목 필수**이므로 해당 용어 제거.
> 또한 3과목을 한 차트에 겹쳐 보여주는 대신, **과목별로 선택하여 해당 과목의 점수 분포**를 보여주는 방식으로 변경.

#### 상단: 채점자 예측 결과 요약 카드

```
┌──────────────────────────────────────────┐
│  채점자 예측 결과                            │
│                                          │
│  최고점    242.50      채점인원      596명  │
│  평균점    189.63      1배수 입력자 컷       │
│                        217.50             │
│                                          │
│  ※ 해당 직렬 채점자 중에서 선발인원수에       │
│    해당하는 순위의 채점자 컷 (조정점수 기준)   │
└──────────────────────────────────────────┘
```

#### 하단: 과목별 채점자 성적분포도

과목 탭으로 **총점 / 개별 과목**을 선택하면 해당 기준의 점수 분포 바 차트를 표시.

```
┌──────────────────────────────────────────────────────┐
│  채점자 성적분포도                                       │
│                                                      │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐                │
│  │ 총점  │ │ 헌법  │ │형사법 │ │경찰학 │  ← 과목 탭    │
│  └──────┘ └──────┘ └──────┘ └──────┘                │
│  ※ 경행경채 사용자: "헌법" 탭이 "범죄학" 으로 변경       │
│                                                      │
│  [ 총점 선택 시 ]                                      │
│                                                      │
│  210 ┤                              ████  내위치      │
│      │                              ████    ↓        │
│  168 ┤                        159명  ████  209명      │
│      │                        ████  ████             │
│  105 ┤                   29명  ████  ████             │
│      │              11명 ████  ████  ████             │
│   42 ┤     4명  ████ ████ ████  ████  ████   5명      │
│      │ 0명 ████ ████ ████ ████  ████  ████  ████  0명 │
│      └───────────────────────────────────────────    │
│       0~50  50~  100~ 150~ 200~  250점               │
│                                                      │
│  [ 형사법 선택 시 ]                                     │
│                                                      │
│   85 ┤                  ████                          │
│      │            45명  ████  78명                     │
│   63 ┤      32명  ████  ████  ████  내위치             │
│      │      ████  ████  ████  ████   ↓               │
│   42 ┤ 18명 ████  ████  ████  ████  ████              │
│      │ ████ ████  ████  ████  ████  ████  12명        │
│      └──────────────────────────────────────         │
│       40미만  40~  50~  60~  70~  80~  90~            │
│       (과락)  49   59   69   79   89   100            │
│                                                      │
│  ※ 40점 미만 구간은 빨간색(과락)으로 강조               │
│  ※ 내 위치가 해당하는 구간에 마커 표시                    │
└──────────────────────────────────────────────────────┘
```

#### 과목 탭별 점수 구간 설정

| 과목 탭 | 만점 | 구간 단위 | 구간 수 | 과락 표시 |
|--------|------|---------|--------|---------|
| **총점** | 250점 | 50점 | 6구간 (0~49, 50~99, ..., 200~250) | 없음 |
| **헌법/범죄학** | 50점 | 10점 | 6구간 (20미만, 20~29, 30~39, 40~50) | 20점 미만 빨간색 |
| **형사법** | 100점 | 10점 | 7구간 (40미만, 40~49, ..., 90~100) | 40점 미만 빨간색 |
| **경찰학** | 100점 | 10점 | 7구간 (40미만, 40~49, ..., 90~100) | 40점 미만 빨간색 |

- Recharts BarChart
- X축: 과목별 동적 점수 구간 (위 테이블 참조)
- Y축: 인원 수
- **과락 구간**: 빨간색 막대로 강조 (과목별 만점의 40% 미만)
- **내 위치**: 해당 구간에 "내위치" 라벨 + 마커/강조
- 각 막대 위에 인원 수 라벨 표시

### 5.6 [E] 성적 분포도 & 경쟁자 정보

> 참고 자료/3.png 하단

```
┌──────────────────────────────────────────────────────┐
│  성적 분포도&경쟁자 정보                                 │
│                                                      │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────┐ │
│  │ 확실권     │  │ 유력권    │  │ 가능권    │  │ 도전권│ │
│  │   125명   │  │   36명   │  │   39명   │  │ 396명│ │
│  └──────────┘  └──────────┘  └──────────┘  └──────┘ │
│                                                      │
│  ┌──────┬──────────────┬────────┬──────────┐         │
│  │ 석차  │ 아이디         │ 점수   │ 세부성적  │         │
│  ├──────┼──────────────┼────────┼──────────┤         │
│  │  1   │ c1614****    │ 242.5  │ [성적보기] │         │
│  │  2   │ c1642****    │ 235.0  │ [성적보기] │         │
│  │  3   │ ★ 나          │ 217.5  │ [성적보기] │         │
│  │ ...  │              │        │          │         │
│  └──────┴──────────────┴────────┴──────────┘         │
│                                                      │
│  [이전] [1] [2] [3] ... [다음]                         │
└──────────────────────────────────────────────────────┘
```

- **등급별 인원 분포 카드**: 확실권/유력권/가능권/도전권 각 인원 (기존 구현 유지)
- **경쟁자 순위 테이블**: 참고 자료/3.png 기반 디자인
  - 석차 | 아이디(마스킹) | 점수 | 세부성적보기
  - **"세부성적보기"** 열 추가: 클릭 시 해당 사용자의 과목별 점수 모달
  - "★ 나" 행 강조 (파란 배경)
  - 페이지네이션 (20개/페이지)

### 5.7 [F] 동일 직렬 채점자 성적 (지역별)

> 참고: `20260220_202846.png`

```
┌──────────────────────────────────────────────────────┐
│  동일 직렬 채점자 성적                                   │
│                                                      │
│  과목선택: [전체 ▼]    유형: [공채 ▼]                    │
│                                                      │
│  [전체] [서울] [인천] [대전] [대구] [울산] [부산] [광주]  │
│  [충남] [충북] [전남] [전북] [경남] [경북] [경기남부]     │
│  [경기북부] [강원] [제주] [세종]                         │
│                                                      │
│  ┌────────┬──────┬──────┬──────┬──────────┬────────┐ │
│  │모집직렬 │선발  │출원  │총참  │1배수     │예측분석│ │
│  │        │인원  │인원  │인원  │입력자 컷  │보기   │ │
│  ├────────┼──────┼──────┼──────┼──────────┼────────┤ │
│  │서울-공채│ 625  │6,447 │ 302  │325.7 이상│[보기]  │ │
│  │서울-공채│ 181  │3,523 │  98  │315.8 이상│[보기]  │ │
│  │인천-공채│  81  │1,464 │  45  │308.5 이상│[보기]  │ │
│  │인천-공채│  30  │  721 │  22  │323.5 이상│[보기]  │ │
│  │대구-공채│  92  │  ...│  ...│  ...     │[보기]  │ │
│  │ ...    │      │      │      │          │        │ │
│  └────────┴──────┴──────┴──────┴──────────┴────────┘ │
│                                                      │
└──────────────────────────────────────────────────────┘
```

- 지역 탭 필터: 클릭 시 해당 지역만 필터
- **"예측분석 보기"** 클릭 시 모달:
  - 해당 지역+유형의 등급별 점수 범위
  - 등급별 인원 분포
  - 미니 성적분포도

### 5.8 기존 대비 변경 요약

| 항목 | 기존 | 변경 |
|------|------|------|
| 탭 라벨 | "합격 컷/경쟁자 정보" | **"합격예측 분석"** |
| 피라미드 | 사다리꼴 5단계 | **삼각형 피라미드 4단계** (참고 자료/3.png 스타일) |
| 피라미드 색상 | 단색 계열 | **그라데이션** (진한 남색→하늘색) |
| 경쟁자 테이블 | 석차/이름/점수 3열 | **석차/아이디/점수/세부성적보기 4열** |
| 등급별 바 차트 | 없음 | **[신규C] 추가** |
| 채점자 통계 | 없음 | **[신규D] 추가** |
| 성적분포도 | 없음 | **[신규D] 과목별 선택식 분포도 추가** (총점/헌법/형사법/경찰학 탭) |
| 지역별 비교 | 없음 | **[신규F] 추가** |

### 5.9 API 변경

#### 기존 `GET /api/prediction` 응답 확장

```typescript
interface PredictionResult {
  // ... 기존 필드 (summary, pyramid, competitors, updatedAt)

  // 신규: 채점자 예측 결과
  poolStats: {
    maxScore: number;
    avgScore: number;
    participantCount: number;
    oneMultipleCutScore: number | null;
  };

  // 신규: 과목별 성적분포도
  scoreDistributions: {
    total: ScoreDistributionBucket[];   // 총점 기준
    subjects: Array<{
      subjectId: number;
      subjectName: string;              // "헌법", "형사법", "경찰학" 등
      maxScore: number;                 // 50 또는 100
      failThreshold: number;            // 과락 기준 (20 또는 40)
      myScore: number;                  // 내 해당 과목 점수
      buckets: ScoreDistributionBucket[];
    }>;
  };
}

interface ScoreDistributionBucket {
  bucketStart: number;
  bucketEnd: number;
  label: string;                        // "40미만", "40~49" 등
  count: number;
  isMyBucket: boolean;
  isFail: boolean;                      // 과락 구간 여부 (빨간색 표시용)
}
```

#### 신규 `GET /api/prediction/regions`

```typescript
// GET /api/prediction/regions?examType={PUBLIC|CAREER}

interface RegionPredictionResponse {
  examId: number;
  examType: "PUBLIC" | "CAREER";
  regions: Array<{
    regionId: number;
    regionName: string;
    recruitCount: number;
    estimatedApplicants: number;
    participantCount: number;
    oneMultipleCutScore: number | null;
    passMultiple: number;
    passLineScore: number | null;
    pyramid: {
      sure: { count: number; minScore: number | null };
      likely: { count: number; minScore: number | null };
      possible: { count: number; minScore: number | null };
      challenge: { count: number; minScore: number | null };
    };
  }>;
}
```

---

## 6. 탭5: 댓글 (`/exam/comments`)

### 6.1 변경점

- 탭 라벨: "실시간 댓글" → **"댓글"**
- 기능 변경 없음

---

## 7. DB 스키마 변경

### 7.1 DifficultyRating enum 확장 (3단계 → 5단계)

```sql
-- MySQL enum 값 추가
ALTER TABLE DifficultyRating MODIFY COLUMN rating
  ENUM('VERY_EASY','EASY','NORMAL','HARD','VERY_HARD') NOT NULL;
```

- 기존 EASY/NORMAL/HARD 데이터 유지
- VERY_EASY, VERY_HARD 추가

### 7.2 Region 테이블 칼럼 추가

```prisma
model Region {
  // ... 기존 필드
  applicantCount       Int?    // 실제 출원인원 (공채) - null이면 추정치 사용
  applicantCountCareer Int?    // 실제 출원인원 (경행경채) - null이면 추정치 사용
}
```

### 7.3 마이그레이션 순서

1. Region 테이블에 nullable 칼럼 2개 추가
2. DifficultyRating enum에 2개 값 추가
3. 기존 데이터 영향 없음

---

## 8. 파일 변경 목록

### 8.1 수정 파일

| 파일 | 변경 내용 |
|------|---------|
| `src/components/layout/ExamTabNavigation.tsx` | 5개 탭, 라벨 변경, 풀서비스 메인 항상 활성 |
| `src/app/exam/page.tsx` | 리디렉트: `/exam/input` → `/exam/main` |
| `src/app/exam/layout.tsx` | 풀서비스 메인 탭 조건 처리 |
| `src/app/exam/input/page.tsx` | 참고 자료/1.png 기반 폼 레이아웃 재배치, 제목/버튼 변경 |
| `src/app/exam/result/page.tsx` | 참고 자료/2.png 기반 레이아웃 + 정오표 + 비교 차트 |
| `src/app/exam/prediction/page.tsx` | 참고 자료/3.png 기반 재구성 + 신규 섹션 C,D,F 통합 |
| `src/app/api/result/route.ts` | answers 배열 + averageScore/maxScoreInPool 추가 |
| `src/app/api/prediction/route.ts` | poolStats + scoreDistribution 추가 |
| `src/lib/prediction.ts` | poolStats, scoreDistribution 계산 로직 |
| `src/lib/difficulty.ts` | 5단계 체감난이도 지원 |
| `src/components/exam/DifficultySelector.tsx` | 5단계 선택 UI |
| `src/app/admin/regions/page.tsx` | 출원인원 입력 칼럼 추가 |
| `src/app/api/admin/regions/route.ts` | 출원인원 필드 CRUD |
| `prisma/schema.prisma` | DifficultyRating enum 변경 + Region 칼럼 추가 |
| `src/types/index.ts` | 신규 타입 추가 |

### 8.2 신규 파일

| 파일 | 설명 |
|------|------|
| **페이지** | |
| `src/app/exam/main/page.tsx` | 풀서비스 메인 페이지 |
| **API** | |
| `src/app/api/main-stats/route.ts` | 풀서비스 메인 통합 통계 API |
| `src/app/api/prediction/regions/route.ts` | 지역별 예측 통계 API |
| **풀서비스 메인 컴포넌트** | |
| `src/components/main/ExamInfoHeader.tsx` | 시험 정보 + 참여 현황 헤더 |
| `src/components/main/LivePredictionTable.tsx` | 실시간 합격예측 테이블 |
| `src/components/main/CompetitiveRankChart.tsx` | 최대/최소 경쟁 TOP5 차트 |
| `src/components/main/DifficultyPanel5Level.tsx` | 5단계 체감난이도 차트 |
| **합격예측 분석 컴포넌트** | |
| `src/components/prediction/PyramidTriangle.tsx` | 삼각형 피라미드 (3.png 스타일) |
| `src/components/prediction/ScoreRangeChart.tsx` | 등급별 점수대 바 차트 |
| `src/components/prediction/PoolStatsCard.tsx` | 채점자 예측 결과 카드 |
| `src/components/prediction/ScoreDistributionChart.tsx` | 성적분포도 히스토그램 |
| `src/components/prediction/RegionComparisonTable.tsx` | 지역별 채점자 성적 테이블 |
| `src/components/prediction/RegionDetailModal.tsx` | 예측분석 보기 모달 |
| `src/components/prediction/CompetitorDetailModal.tsx` | 세부성적보기 모달 |
| **채점결과 분석 컴포넌트** | |
| `src/components/result/AnswerSheet.tsx` | 정오표 컴포넌트 |

---

## 9. API 엔드포인트 요약

### 9.1 신규

| 메서드 | 엔드포인트 | 인증 | 설명 |
|--------|----------|------|------|
| GET | `/api/main-stats` | 로그인 | 풀서비스 메인 통합 통계 |
| GET | `/api/prediction/regions` | 로그인 | 지역별 예측 통계 |

### 9.2 변경

| 메서드 | 엔드포인트 | 변경 내용 |
|--------|----------|---------|
| GET | `/api/result` | `answers` + 과목별 `averageScore`/`maxScoreInPool` |
| GET | `/api/prediction` | `poolStats` + `scoreDistribution` |
| GET | `/api/difficulty` | 5단계 응답 지원 |
| PUT | `/api/admin/regions` | `applicantCount`/`applicantCountCareer` 필드 |

---

## 10. 개발 순서 (권장)

### Phase 1: 기반 작업

1. Prisma 스키마 변경 + 마이그레이션
2. TypeScript 타입 정의 추가
3. `ExamTabNavigation.tsx` 5개 탭으로 변경
4. `/exam/page.tsx` 리디렉트 변경

### Phase 2: 풀서비스 메인 (탭1)

5. `GET /api/main-stats` API 구현
6. `ExamInfoHeader` 컴포넌트
7. `LivePredictionTable` 컴포넌트
8. `CompetitiveRankChart` 컴포넌트
9. `DifficultyPanel5Level` 컴포넌트
10. `/exam/main/page.tsx` 페이지 조립

### Phase 3: 빠른 채점 서비스 (탭2)

11. 참고 자료/1.png 기반 폼 레이아웃 재배치
12. 5단계 체감난이도 입력 UI 변경

### Phase 4: 채점결과 분석 (탭3)

13. 참고 자료/2.png 기반 레이아웃 재배치
14. `GET /api/result` 응답 확장 (answers + 비교 데이터)
15. `AnswerSheet` 정오표 컴포넌트
16. 과목별 비교 차트 오버레이

### Phase 5: 합격예측 분석 (탭4)

17. 참고 자료/3.png 기반 레이아웃 재구성
18. `PyramidTriangle` 삼각형 피라미드 컴포넌트
19. `prediction.ts` 확장 (poolStats, scoreDistribution)
20. `ScoreRangeChart` 등급별 점수대 바 차트
21. `PoolStatsCard` + `ScoreDistributionChart` 채점자 통계
22. `GET /api/prediction/regions` API 구현
23. `RegionComparisonTable` + `RegionDetailModal` 지역별 비교
24. `CompetitorDetailModal` 세부성적보기 모달

### Phase 6: 관리자 + 마무리

25. `/admin/regions` 출원인원 입력 추가
26. 전체 플로우 테스트
27. 모바일 반응형 확인
28. 성능 최적화 (캐싱, 폴링 최적화)

---

## 11. 성능 고려사항

### 11.1 풀서비스 메인 (`/api/main-stats`)

- 18개 지역 × 2개 유형 = 최대 36행 집계
- 각 행마다 순위 계산 필요 → **서버 캐시 60초 TTL**

```typescript
const CACHE_TTL_MS = 60_000;
let cached: { data: MainStatsResponse; at: number } | null = null;

async function getMainStats(examId: number) {
  if (cached && Date.now() - cached.at < CACHE_TTL_MS) return cached.data;
  const data = await computeMainStats(examId);
  cached = { data, at: Date.now() };
  return data;
}
```

### 11.2 합격예측 지역별 (`/api/prediction/regions`)

- 18개 지역 일괄 집계 → Raw SQL GROUP BY regionId

```sql
SELECT regionId, COUNT(*) as cnt, MAX(finalScore) as maxScore,
       AVG(finalScore) as avgScore
FROM Submission
WHERE examId = ? AND examType = ?
  AND id NOT IN (SELECT submissionId FROM SubjectScore WHERE isFailed = 1)
GROUP BY regionId;
```

### 11.3 정오표 정답률

- 문항별 정답률은 전체 참여자 대상 → 캐시 또는 미리 계산
- 정답키 변경 시 캐시 무효화

---

## 12. 관리자 기능 추가

### 12.1 `/admin/regions` — 출원인원 입력

기존 지역 관리 테이블에 2개 칼럼 추가:

| 기존 칼럼 | 추가 칼럼 |
|---------|---------|
| 지역명, 모집인원(공채), 모집인원(경행경채) | **출원인원(공채)**, **출원인원(경행경채)** |

- 빈 값이면 "추정" 표시, 값 입력 시 실제값 사용
- 경쟁률 = (실제 출원인원 or 추정치) / 선발인원

### 12.2 `/admin/site` — 실시간 업데이트 설정

- `site.mainPageAutoRefresh`: true/false 토글
- `site.mainPageRefreshInterval`: 갱신 간격 (초, 기본 60)
